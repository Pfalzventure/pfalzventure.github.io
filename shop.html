<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tracking Snippet -->
  <script defer data-domain="pfalzventure.de" src="https://plausible.io/js/script.js"></script>

  <title>Shop ‚Äì Pfalzventure</title>
  <link rel="stylesheet" href="style.css">

  <!-- PayPal SDK -->
  <script src="https://www.paypal.com/sdk/js?client-id=AQbF-v1VWk6QCLKdNODfXJb-fUAcoTsnE1ux9JvHUWNYuJQE1xskgSu7ff_qniWdL168KWEw_oX7iCHB&currency=EUR"></script>
</head>
<body>
  <!-- ============================
       Header mit Navigation
       ============================ -->
  <header>
    <div class="container">
      <a href="index.html" class="logo">
        <img src="assets/Logo2.png" alt="Pfalzventure Logo">
      </a>

      <div class="burger" onclick="toggleMenu()">‚ò∞</div>

      <nav>
        <ul class="nav-links" id="nav-links">
          <li><a href="index.html">Start</a></li>
          <li><a href="kurse.html">Kurse</a></li>
          <li><a href="shop.html" class="active">Shop</a></li>
          <li><a href="kontakt.html">Kontakt</a></li>
        </ul>
      </nav>

      <button onclick="toggleCart()" class="btn cart-btn">üõí Warenkorb (<span id="cart-count">0</span>)</button>
    </div>
  </header>

  <script>
    function toggleMenu() {
      document.getElementById("nav-links").classList.toggle("nav-active");
    }

    document.addEventListener("click", function(event) {
      const menu = document.getElementById("nav-links");
      const burger = document.querySelector(".burger");
      if (menu && burger && !menu.contains(event.target) && !burger.contains(event.target)) {
        menu.classList.remove("nav-active");
      }
    });
  </script>

  <!-- ============================
       Shop-Bereich
  ============================ -->
  <main class="shop-section">
    <h1>Shop</h1>

    <!-- Produkt 1 -->
    <div class="product" id="survivalkit">
      <h2>Survival Kit</h2>
      <p>
        Dein Handwerkszeug zum √úberleben. Mit diesem Kit hast du alles was du brauchst um in der Natur √ºberleben zu k√∂nnen:
        <br><br>
        - Feuerstahl<br>
        - Messer<br>
        - Trinkgef√§√ü<br>
        - Kompass<br>
        - Medipack<br>
        - Schnur<br>
        - Panzertape<br>
        - Rettungsdecke<br>
        - und vieles mehr
      </p>
      <p>
        In den Kursen kannst du entweder mit deiner eigenen Ausr√ºstung oder mit diesem Kit umgehen lernen.
        <br>Spar Tipp: Das Kit gibt es verg√ºnstigt in den Kursen.
      </p>
      <button class="btn add-btn" onclick="addToCart('Survival Kit', 44.90)">In den Warenkorb (44,90 ‚Ç¨)</button>
    </div>

    <!-- Produkt 2 -->
    <div class="product" id="crashkurs">
      <h2>1 Tages Survival Crashkurs</h2>
      <p>Erlerne an nur einem Tag die wichtigsten Skills um in der Natur √ºberleben zu k√∂nnen. <br>Bitte w√§hle einen Termin aus der Liste an dem du den Kurs besuchen m√∂chtest.</p>
      <label for="kursTermine1">M√∂gliche Termine:</label><br>
      <select id="kursTermine1" size="4" style="width:100%; max-width:320px;"></select>
      <br><br>
      <a href="kurse.html#crashkurs" class="btn info-btn">‚ÑπÔ∏è Mehr Infos</a><br><br>
      <button class="btn add-btn" onclick="addCourseVoucher('kursTermine1','1 Tages Survival Crashkurs',59.90)">In den Warenkorb (59,90 ‚Ç¨)</button>
    </div>

    <!-- Produkt 3 -->
    <div class="product" id="intensivkurs">
      <h2>2 Tages Survival Intensivkurs</h2>
      <p>Erlerne an zwei Tagen die wichtigsten Skills um in der Natur √ºberleben zu k√∂nnen und festige diese in einem realit√§tsnahen Szenario. 
        <br>Bitte w√§hle einen Termin aus der Liste an dem du den Kurs besuchen m√∂chtest.</p>
      <label for="kursTermine2">M√∂gliche Termine:</label><br>
      <select id="kursTermine2" size="4" style="width:100%; max-width:320px;"></select>
      <br><br>
      <a href="kurse.html#intensivkurs" class="btn info-btn">‚ÑπÔ∏è Mehr Infos</a><br><br>
      <button class="btn add-btn" onclick="addCourseVoucher('kursTermine2','2 Tages Survival Intensivkurs',149.90)">In den Warenkorb (149,90 ‚Ç¨)</button>
    </div>

    <!-- Produkt 4 -->
    <div class="product" id="bushcraftkurs">
      <h2>3 Tages Bushcraft Kurs</h2>
      <p>Du suchst eine echte Herausforderung und liebst es an deine Grenzen zu gehen? Lerne in 3 Tagen selbst ohne Hilfsmittel in der Natur zu √ºberleben. 
        <br>Bitte w√§hle einen Termin aus der Liste an dem du den Kurs besuchen m√∂chtest.</p>
      <label for="kursTermine3">M√∂gliche Termine:</label><br>
      <select id="kursTermine3" size="4" style="width:100%; max-width:320px;"></select>
      <br><br>
      <a href="kurse.html#bushcraftkurs" class="btn info-btn">‚ÑπÔ∏è Mehr Infos</a><br><br>
      <button class="btn add-btn" onclick="addCourseVoucher('kursTermine3','3 Tages Bushcraft Kurs',299.90)">In den Warenkorb (299,90 ‚Ç¨)</button>
    </div>

    <!-- Produkt 5 -->
    <div class="product" id="gutschein">
      <h2>Wert-Gutschein</h2>
      <p>Auf der Suche nach einem au√üergew√∂hnlichem Geschenk? W√§hle deinen Wunschbetrag und erhalte einen sch√∂n gestalteten Gutschein.</p>
      <label for="voucherAmount">Betrag in ‚Ç¨:</label><br>
      <input type="number" id="voucherAmount" value="50" min="10" step="5"><br><br>
      <label for="voucherMessage">Widmung / Freitext:</label><br>
      <textarea id="voucherMessage" rows="3" style="width:100%; max-width:320px;"></textarea><br><br>
      <button class="btn add-btn" onclick="addVoucher()">In den Warenkorb</button>
    </div>
  </main>



  <!-- ============================
       Footer
  ============================ -->
  <footer>
    <p>¬© 2025 Pfalzventure ‚Äì Robert Prokasky</p>
    <p><a href="impressum.html">Impressum</a> | <a href="datenschutz.html">Datenschutz</a></p>
  </footer>

  <div id="paypal-cookie-banner" class="paypal-banner" style="display:none;">
    <p>
      F√ºr die Nutzung der PayPal-Zahlungsfunktion werden technisch notwendige Cookies von PayPal gesetzt.
      <a href="https://www.paypal.com/de/webapps/mpp/ua/privacy-full" target="_blank" rel="noopener noreferrer">Mehr erfahren</a>
    </p>
    <button id="paypal-cookie-ok">Alles klar!</button>
  </div>

 
 <!-- üîÑ Kurstermine automatisch laden -->
<script>
document.addEventListener("DOMContentLoaded", () => {

  /**
   * L√§dt Termine aus einer JSON-Datei und bef√ºllt ein Dropdown.
   * Wenn keine Termine vorhanden sind, wird das Dropdown deaktiviert.
   * @param {string} selectId - ID des <select>-Elements
   * @param {string} jsonPath - Pfad zur JSON-Datei (z.B. "assets/kurstermine_1_tag.json")
   */
  async function loadCourseDates(selectId, jsonPath) {
    const select = document.getElementById(selectId);
    if (!select) return console.warn(`‚ö†Ô∏è Dropdown #${selectId} nicht gefunden.`);

    try {
      const res = await fetch(jsonPath);
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const data = await res.json();

      const termine = data.termine || data;
      if (!Array.isArray(termine) || termine.length === 0) {
        throw new Error("Keine Termine gefunden");
      }

      // Dropdown leeren und bef√ºllen
      select.innerHTML = "";
      termine.forEach(t => {
        const opt = document.createElement("option");
        opt.value = t.id || t.text || t;
        opt.textContent = t.text || t.name || t;
        select.appendChild(opt);
      });

      select.disabled = false;
      console.log(`‚úÖ ${jsonPath} geladen (${termine.length} Termine)`);

    } catch (err) {
      console.warn(`‚ö†Ô∏è ${jsonPath} konnte nicht geladen werden:`, err);
      select.innerHTML = "";
      const opt = document.createElement("option");
      opt.textContent = "Derzeit keine Termine verf√ºgbar";
      opt.disabled = true;
      select.appendChild(opt);
      select.disabled = true;
    }
  }

  // Alle Kurs-Dateien laden
  loadCourseDates("kursTermine1", "assets/kurstermine_1_tag.json");
  loadCourseDates("kursTermine2", "assets/kurstermine_2_tage.json");
  loadCourseDates("kursTermine3", "assets/kurstermine_3_tage.json");

});
</script>

<!-- ============================
  Vollst√§ndiger zentraler Warenkorb (einf√ºgen vor </body>)
  Enth√§lt: UI, CSS, JS, PayPal (falls SDK geladen), Gutscheine via Formspree
============================ -->
<!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<!-- HTML -->
<div id="cart" class="closed" aria-hidden="true">
  <header id="cart-header">
    <h3>üõí Dein Warenkorb</h3>
    <button id="cart-close-btn" aria-label="Warenkorb schlie√üen">‚úñ</button>
  </header>

  <section id="cart-body">
    <ul id="cart-items" class="cart-list" aria-live="polite"></ul>

    <div class="cart-discount">
      <label for="voucherCode">üéüÔ∏è Gutscheincode:</label>
      <input id="voucherCode" type="text" placeholder="Code eingeben">
      <label for="customerEmail">üìß Deine E-Mail-Adresse:</label>
      <input id="customerEmail" type="email" placeholder="name@example.com">
      <button id="voucherSubmitBtn" class="btn">Gutschein einl√∂sen</button>
      <p id="voucherMessage" role="status"></p>
    </div>

    <div id="paypal-button-container" style="margin-top: 12px;"></div>

    <footer id="cart-footer">
      <p><strong>Gesamt: <span id="cart-total">0.00</span> ‚Ç¨</strong></p>
    </footer>
  </section>
</div>

<!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<!-- CSS (selbst-enthaltend, kann bei Bedarf an style.css angepasst werden) -->
<style>
/* Container */
#cart {
  position: fixed;
  top: 80px;
  right: 20px;
  width: 340px;
  max-width: 92vw;
  max-height: 75vh;
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 12px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.12);
  overflow: hidden;
  display: flex;
  flex-direction: column;
  z-index: 1100;
  opacity: 0;
  transform: translateY(-8px);
  pointer-events: none;
  transition: opacity .22s ease, transform .22s ease;
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}
#cart.open, #cart:not(.closed) {
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}

/* Header */
#cart-header {
  display:flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 14px;
  border-bottom: 1px solid #eee;
  background: #fafafa;
}
#cart-header h3 { margin: 0; font-size: 1rem; }

/* Body */
#cart-body {
  padding: 12px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  overflow: auto;
}

/* Items */
.cart-list { list-style: none; padding: 0; margin: 0; display: block; }
.cart-item {
  display:flex;
  justify-content: space-between;
  align-items: center;
  gap: 8px;
  padding: 8px 6px;
  border-bottom: 1px solid #f0f0f0;
}
.cart-item .left { flex:1; }
.cart-item .right { text-align: right; min-width: 90px; }

/* Controls */
.cart-controls { display:inline-flex; gap:6px; align-items:center; margin-top:6px; }
.cart-controls button { border:1px solid #ddd; background:#f7f7f7; padding:4px 8px; border-radius:6px; cursor:pointer; }
.cart-qty { min-width:26px; text-align:center; font-weight:600; display:inline-block; }

/* Discount */
.cart-discount { margin-top:8px; padding-top:8px; border-top:1px dashed #eee; display:flex; flex-direction:column; gap:6px; }
.cart-discount input { padding:8px; border:1px solid #ddd; border-radius:6px; width:100%; box-sizing:border-box; }
.cart-discount label { font-weight:600; font-size:0.92rem; }

/* Footer */
#cart-footer { padding: 10px 12px; border-top: 1px solid #eee; background: #fff; }

/* Close & buttons */
#cart-close-btn { background:transparent; border:none; font-size:1.1rem; cursor:pointer; }
.btn { display:inline-block; padding:8px 10px; border-radius:8px; background:#2f7a4a; color:#fff; border:none; cursor:pointer; }

/* Bounce animation on cart toggle */
@keyframes cart-bounce {
  0% { transform: scale(1); }
  30% { transform: scale(1.18); }
  50% { transform: scale(0.92); }
  70% { transform: scale(1.08); }
  100% { transform: scale(1); }
}
#cart-toggle.bounce { animation: cart-bounce 0.6s ease; }
</style>

<!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<!-- JS: komplette Warenkorb-Logik -->
<script>
(function () {
  // -------------------------
  // Grundzustand / Storage
  // -------------------------
  let cart = JSON.parse(localStorage.getItem("cart") || "[]");

  // Helfer
  function saveCartLocal() {
    localStorage.setItem("cart", JSON.stringify(cart));
  }
  function formatPrice(num) {
    return Number(num).toFixed(2);
  }

  // -------------------------
  // DOM-Referenzen (dynamisch holen)
  // -------------------------
  function $id(id) { return document.getElementById(id); }

  // -------------------------
  // Render
  // -------------------------
  function updateCartUI() {
    const list = $id("cart-items");
    if (!list) return;
    list.innerHTML = "";

    cart.forEach((item, i) => {
      const li = document.createElement("li");
      li.className = "cart-item";
      li.innerHTML = `
        <div class="left">
          <div><strong>${escapeHtml(item.name)}</strong></div>
          <div class="cart-controls">
            <button data-action="dec" data-index="${i}">‚ûñ</button>
            <span class="cart-qty">${item.qty}</span>
            <button data-action="inc" data-index="${i}">‚ûï</button>
          </div>
        </div>
        <div class="right">
          <div class="cart-price">${formatPrice(item.price)} ‚Ç¨</div>
        </div>
      `;
      list.appendChild(li);
    });

    const totalEl = $id("cart-total");
    if (totalEl) totalEl.textContent = formatPrice(getCartTotal());
    const countEl = $id("cart-count");
    if (countEl) countEl.textContent = cart.reduce((s,i)=>s+i.qty,0);
  }

  // -------------------------
  // CRUD
  // -------------------------
  function addToCart(name, price, qty = 1) {
    const existing = cart.find(i => i.name === name && Number(i.price) === Number(price));
    if (existing) existing.qty += qty;
    else cart.push({ name: String(name), price: Number(price), qty: qty });
    saveCartLocal();
    updateCartUI();
    triggerCartBounce();
    initPayPalButtons(); // refresh paypal if visible
  }

  function increaseQty(i) { if (cart[i]) { cart[i].qty++; saveCartLocal(); updateCartUI(); initPayPalButtons(); } }
  function decreaseQty(i) { if (cart[i]) { cart[i].qty--; if (cart[i].qty<=0) cart.splice(i,1); saveCartLocal(); updateCartUI(); initPayPalButtons(); } }
  function getCartTotal() { return cart.reduce((s,i)=>s + (Number(i.price) * Number(i.qty)), 0); }

  // -------------------------
  // Sicherheit: rudiment√§rer HTML-escape
  // -------------------------
  function escapeHtml(str) {
    return String(str).replace(/[&<>"']/g, (m) => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
  }

  // -------------------------
  // Bounce
  // -------------------------
  function triggerCartBounce() {
    const tryAdd = () => {
      const cartIcon = document.getElementById("cart-toggle");
      if (!cartIcon) {
        // falls noch nicht da, sp√§ter nochmal versuchen
        setTimeout(tryAdd, 150);
        return;
      }
      cartIcon.classList.add("bounce");
      setTimeout(()=>cartIcon.classList.remove("bounce"), 700);
    };
    tryAdd();
  }

  // -------------------------
  // √ñffnen / Schlie√üen / Klick au√üerhalb
  // -------------------------
  function openCart() {
    const el = $id("cart");
    if (!el) return;
    el.classList.remove("closed");
    el.classList.add("open");
    el.setAttribute("aria-hidden","false");
  }
  function closeCart() {
    const el = $id("cart");
    if (!el) return;
    el.classList.remove("open");
    el.classList.add("closed");
    el.setAttribute("aria-hidden","true");
  }
  function toggleCart() {
    const el = $id("cart");
    if (!el) return;
    if (el.classList.contains("open")) closeCart(); else openCart();
  }

  // global expose toggle so header button still works (onclick="toggleCart()")
  window.toggleCart = toggleCart;

  // Click-outside: delegiere global (idempotent)
  if (!window.__cart_outside_bound) {
    window.__cart_outside_bound = true;
    document.addEventListener("click", (e) => {
      const cartEl = $id("cart");
      const toggle = document.getElementById("cart-toggle");
      if (!cartEl || !toggle) return;
      if (!cartEl.contains(e.target) && !toggle.contains(e.target)) {
        closeCart();
      }
    });
  }

  // -------------------------
  // PayPal Integration (Smart Buttons)
  // - Erwartet: PayPal SDK ist per <script> in <head> geladen
  // -------------------------
  let paypalRendered = false;
  async function initPayPalButtons() {
    // Entferne vorhandene Buttons
    const container = $id("paypal-button-container");
    if (!container) return;
    container.innerHTML = "";

    if (!window.paypal) {
      // PayPal SDK nicht geladen ‚Äî nichts weiter tun
      return;
    }

    if (cart.length === 0) {
      // kein Bedarf
      return;
    }

    try {
      // render neu
      paypalRendered = true;
      paypal.Buttons({
        createOrder: (data, actions) => {
          return actions.order.create({
            purchase_units: [{
              description: cart.map(i => `${i.name} x${i.qty}`).join("; "),
              amount: {
                currency_code: "EUR",
                value: getCartTotal().toFixed(2)
              }
            }]
          });
        },
        onApprove: (data, actions) => {
          return actions.order.capture().then((details) => {
            // Danke-Nachricht
            alert("Danke f√ºr deine Bestellung" + (details.payer?.name?.given_name ? ", " + details.payer.name.given_name : "") + "!");
            // optional: sende Formspree (Zahlungsbest√§tigung)
            sendFormspreeOnOrder(details);
            // reset cart
            cart = [];
            saveCartLocal();
            updateCartUI();
            closeCart();
            initPayPalButtons(); // Buttons wegr√§umen
          });
        },
        onError: (err) => {
          console.error("PayPal Fehler:", err);
          alert("‚ö†Ô∏è Zahlung fehlgeschlagen. Bitte versuche es erneut.");
        }
      }).render('#paypal-button-container');
    } catch (err) {
      console.error("Fehler beim Initialisieren von PayPal:", err);
    }
  }

  // -------------------------
  // Gutschein + Formspree (gleiches Formular)
  // -------------------------
  async function submitVoucherRequest() {
    const code = ($id("voucherCode") || {}).value || "";
    const email = ($id("customerEmail") || {}).value || "";
    const msgEl = $id("voucherMessage");
    if (!msgEl) return;

    // Validierung
    if (!code.trim()) {
      msgEl.style.color = "red"; msgEl.textContent = "Bitte Gutscheincode eingeben."; return;
    }
    if (!email.includes("@")) {
      msgEl.style.color = "red"; msgEl.textContent = "Bitte g√ºltige E-Mail-Adresse eingeben."; return;
    }

    // Visuelles Feedback
    msgEl.style.color = "green";
    msgEl.textContent = "‚úÖ Dein Gutscheincode wird gepr√ºft. Du erh√§ltst bald eine angepasste Rechnung per E-Mail.";

    // Senden an Formspree
    try {
      const response = await fetch("https://formspree.io/f/mldlyqdz", {
        method: "POST",
        headers: { "Content-Type":"application/json" },
        body: JSON.stringify({
          _subject: "ü™ô Neuer Gutschein eingel√∂st",
          code: code,
          kunden_email: email,
          warenkorb_summe: getCartTotal().toFixed(2),
          warenkorb_inhalt: cart.map(i => `${i.name} x${i.qty}`).join("; ")
        })
      });
      if (!response.ok) throw new Error("Fehler beim Senden: " + response.status);
      console.log("Gutschein-Anfrage gesendet.");
    } catch (err) {
      console.error("Fehler beim Senden an Formspree:", err);
      msgEl.style.color = "red";
      msgEl.textContent = "‚ö†Ô∏è Gutschein konnte nicht gesendet werden. Bitte versuche es sp√§ter.";
    }

    // Felder leeren nach kurzer Zeit
    setTimeout(() => {
      if ($id("voucherCode")) $id("voucherCode").value = "";
      if ($id("customerEmail")) $id("customerEmail").value = "";
    }, 9000);

    // Nachricht ausblenden
    setTimeout(()=>{ if (msgEl) msgEl.textContent = ""; }, 8000);
  }

  // Optionale: beim Checkout (nach PayPal Erfolg) Formular an dich
  async function sendFormspreeOnOrder(paypalDetails) {
    try {
      const response = await fetch("https://formspree.io/f/mldlyqdz", {
        method: "POST",
        headers: { "Content-Type":"application/json" },
        body: JSON.stringify({
          _subject: "‚úÖ Neue Bestellung (PayPal)",
          payer: paypalDetails.payer || {},
          amount: getCartTotal().toFixed(2),
          items: cart.map(i => `${i.name} x${i.qty}`).join("; ")
        })
      });
      if (!response.ok) throw new Error("Formspree send failed: " + response.status);
      console.log("Bestellbest√§tigung an Formspree gesendet.");
    } catch (err) {
      console.warn("Bestell-Mail konnte nicht gesendet werden:", err);
    }
  }

  // -------------------------
  // Event-Handling: Delegation f√ºr Artikel-Buttons
  // -------------------------
  document.addEventListener("click", function (e) {
    const t = e.target;
    if (!t) return;

    // Mengenbuttons
    if (t.dataset && t.dataset.action) {
      const idx = Number(t.dataset.index);
      if (t.dataset.action === "inc") { increaseQty(idx); }
      else if (t.dataset.action === "dec") { decreaseQty(idx); }
      return;
    }

    // Footer & close
    if (t.id === "cart-close-btn") { closeCart(); return; }
    if (t.id === "voucherSubmitBtn") { submitVoucherRequest(); return; }
  });

  // -------------------------
  // Initialisierung beim Laden
  // -------------------------
  function initCartOnce() {
    // initial render
    updateCartUI();

    // close button bereits oben gebunden via delegation
    // load paypal buttons if available
    initPayPalButtons();

    // expose addToCart global so product buttons can call it
    window.addToCart = addToCart;
  }

  // Warte bis DOM ready + #cart vorhanden (falls Script sehr fr√ºh eingebunden)
  function waitForCartAndInit(tries = 30) {
    const cartEl = $id("cart");
    if (cartEl) {
      initCartOnce();
      return;
    }
    if (tries <= 0) {
      console.error("Warenkorb-Element nicht gefunden, init abgebrochen.");
      return;
    }
    setTimeout(()=>waitForCartAndInit(tries-1), 150);
  }
  document.addEventListener("DOMContentLoaded", ()=>waitForCartAndInit(30));

  // Expose some helpers for debugging
  window._pf_cart = {
    getRaw: ()=>cart,
    clear: ()=>{ cart=[]; saveCartLocal(); updateCartUI(); initPayPalButtons(); }
  };

})();
</script>
<!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->

<!-- USAGE: 
  - Stelle sicher, dein Header enth√§lt: 
      <button id="cart-toggle" onclick="toggleCart()">üõí Warenkorb (<span id="cart-count">0</span>)</button>
  - Produktbutton-Beispiel:
      <button onclick="addToCart('Survivalkurs 1 Tag', 129.00)">In den Warenkorb</button>
-->

  
</body>
</html>
