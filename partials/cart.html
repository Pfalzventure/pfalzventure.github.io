<!-- ============================ ðŸ›ï¸ Warenkorb-Fenster ============================ -->
<div id="cart" class="closed">
  <h3>ðŸ›’ Dein Warenkorb</h3>
  <ul id="cart-items" class="cart-list"></ul>
  <p><strong>Gesamt: <span id="cart-total">0.00</span> â‚¬</strong></p>

  <!-- ðŸŸ¢ Neuer Bezahl-Button -->
  <button onclick="goToPayment()" class="btn pay-btn">Jetzt bezahlen</button>

  <button onclick="toggleCart()" class="btn close-btn">SchlieÃŸen</button>
</div>

<!-- ============================ ðŸ›ï¸ Warenkorb-Logik============================ -->

<script>
  let cart = JSON.parse(localStorage.getItem("cart") || "[]");

  // ============================
  // ðŸ”„ Speicher
  // ============================
  function saveCart() {
    localStorage.setItem("cart", JSON.stringify(cart));
    updateCart();
  }

  function loadCart() {
    cart = JSON.parse(localStorage.getItem("cart") || "[]");
    updateCart();
  }

  // ============================
  // ðŸ§¾ Artikel hinzufÃ¼gen
  // ============================
  function addToCart(name, price, qty = 1) {
    const existing = cart.find(i => i.name === name && i.price === price);
    if (existing) existing.qty += qty;
    else cart.push({ name, price, qty });
    saveCart();
    triggerCartBounce();
  }

  function triggerCartBounce() {
    const tryBounce = () => {
      const cartIcon = document.getElementById("cart-toggle");
      if (!cartIcon) {
        setTimeout(tryBounce, 100);
        return;
      }
      cartIcon.classList.add("bounce");
      setTimeout(() => cartIcon.classList.remove("bounce"), 600);
    };
    tryBounce();
  }

  // ============================
  // ðŸ“… Kurs mit Termin
  // ============================
  function addCourseVoucher(selectId, kursName, kursPreis) {
    const select = document.getElementById(selectId);
    if (!select) return alert("Keine Termine verfÃ¼gbar.");

    const selected = Array.from(select.selectedOptions).map(o => o.textContent);
    if (selected.length === 0) return alert("Bitte wÃ¤hle einen Termin aus!");

    selected.forEach(term => {
      const name = `${kursName} â€“ Termin: ${term}`;
      const existing = cart.find(i => i.name === name && i.price === kursPreis);
      if (existing) existing.qty++;
      else cart.push({ name, price: kursPreis, qty: 1 });
    });

    saveCart();
    triggerCartBounce();
  }

  // ============================
  // âž•âž– Mengensteuerung
  // ============================
  function increaseQty(i) {
    cart[i].qty++;
    saveCart();
  }

  function decreaseQty(i) {
    if (--cart[i].qty <= 0) cart.splice(i, 1);
    saveCart();
  }

  // ============================
  // ðŸ’° Summe
  // ============================
  function getCartTotal() {
    return cart.reduce((s, i) => s + i.price * i.qty, 0);
  }

  // ============================
  // ðŸ’¬ Anzeige aktualisieren
  // ============================
  function updateCart() {
    const countEl = document.getElementById("cart-count");
    if (countEl) countEl.innerText = cart.reduce((s, i) => s + i.qty, 0);

    const list = document.getElementById("cart-items");
    if (!list) return;
    list.innerHTML = "";

    cart.forEach((item, i) => {
      const li = document.createElement("li");
      li.innerHTML = `
        ${item.name} â€“ ${item.price.toFixed(2)} â‚¬
        <div class="cart-controls">
          <button onclick="decreaseQty(${i})">âž–</button>
          <span class="cart-qty">${item.qty}</span>
          <button onclick="increaseQty(${i})">âž•</button>
        </div>`;
      list.appendChild(li);
    });

    const totalEl = document.getElementById("cart-total");
    if (totalEl) totalEl.innerText = getCartTotal().toFixed(2);
  }

  // ============================
  // ðŸŸ¢ Weiter zur Kasse
  // ============================
  function goToPayment() {
    if (cart.length === 0) {
      alert("Dein Warenkorb ist leer.");
      return;
    }
    window.location.href = "partials/kasse.html";
  }

  // ============================
  // ðŸª„ Ã–ffnen / SchlieÃŸen
  // ============================
  function toggleCart() {
    const el = document.getElementById("cart");
    if (!el) return;
    el.classList.toggle("open");
  }

  function closeCart() {
    const el = document.getElementById("cart");
    if (el) el.classList.remove("open");
  }

  // Klick auÃŸerhalb â†’ schlieÃŸen
  document.addEventListener("click", function (event) {
    const cart = document.getElementById("cart");
    const toggle = document.getElementById("cart-toggle");
    if (!cart || !toggle) return;

    if (event.target.closest("#cart") || event.target.closest("#cart-toggle")) return;

    closeCart();
  }, true);

</script>
