<!-- ============================
     🛒 Warenkorb-Button
     ============================ -->
<button id="cart-toggle" class="btn" style="
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1100;
">
  🛒 <span id="cart-count">0</span>
</button>

<!-- ============================
     🛍️ Warenkorb-Fenster
     ============================ -->
<div id="cart" class="cart closed" style="
  position: fixed;
  top: 80px;
  right: 20px;
  width: 340px;
  max-width: 90vw;
  max-height: 80vh;
  background: white;
  border: 1px solid #ccc;
  border-radius: 12px;
  box-shadow: 0 4px 18px rgba(0, 0, 0, 0.25);
  padding: 16px;
  z-index: 1000;
  overflow-y: auto;
  display: none;
">
  <h3 style="margin:0 0 10px 0;">🛒 Dein Warenkorb</h3>
  <ul id="cart-items" class="cart-list" style="list-style:none;padding:0;margin:0 0 10px 0;"></ul>
  <p style="margin:6px 0;">
    <strong>Gesamt: <span id="cart-total">0.00</span> €</strong>
  </p>

  <div class="cart-discount" style="margin-bottom:10px;">
    <label for="voucherCode">🎟️ Gutscheincode:</label><br>
    <input type="text" id="voucherCode" placeholder="Code eingeben" style="width:100%;">

    <label for="customerEmail">📧 Deine E-Mail-Adresse:</label><br>
    <input type="email" id="customerEmail" placeholder="name@example.com" style="width:100%;">

    <button onclick="submitVoucherRequest()" class="btn" style="margin-top:8px;">Gutschein einlösen</button>
    <p id="voucherMessage" style="margin:4px 0 0 0; font-size:0.9em;"></p>
  </div>

  <div id="paypal-button-container" style="margin-bottom:10px;"></div>
  <button onclick="toggleCart()" class="btn" style="align-self:flex-end;">Schließen</button>
</div>

<script>
let cart = JSON.parse(localStorage.getItem("cart") || "[]");

// ============================
// 🪄 Öffnen / Schließen
// ============================
function toggleCart(forceState = null) {
  const el = document.getElementById("cart");
  if (!el) return;

  const isOpen = el.classList.contains("open");
  const shouldOpen = forceState === true || (!isOpen && forceState === null);
  const shouldClose = forceState === false || (isOpen && forceState === null);

  if (shouldOpen) {
    el.classList.add("open");
    el.classList.remove("closed");
    el.style.display = "block";
  } else if (shouldClose) {
    el.classList.remove("open");
    el.classList.add("closed");
    el.style.display = "none";
  }
}

// Klick außerhalb schließt Warenkorb
document.addEventListener("click", function(event) {
  const cartEl = document.getElementById("cart");
  const toggle = document.getElementById("cart-toggle");
  if (!cartEl || !toggle) return;

  if (!cartEl.contains(event.target) && !toggle.contains(event.target)) {
    toggleCart(false);
  }
});

// Initialzustand: geschlossen
document.addEventListener("DOMContentLoaded", () => {
  toggleCart(false);
  loadCart();
});
</script>
